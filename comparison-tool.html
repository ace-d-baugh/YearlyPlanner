<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Couples Planning Comparison Tool</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      text-align: center;
    }

    header h1 {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 18px;
      opacity: 0.9;
    }

    main {
      padding: 40px;
    }

    /* Upload Section */
    .upload-section {
      background: #f8f9ff;
      padding: 30px;
      border-radius: 8px;
      margin-bottom: 30px;
      border: 2px dashed #667eea;
    }

    .upload-section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .upload-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .upload-box {
      background: white;
      padding: 30px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      text-align: center;
    }

    .upload-box h3 {
      margin-bottom: 15px;
      color: #555;
    }

    .upload-box input[type="file"] {
      display: none;
    }

    .upload-btn {
      display: inline-block;
      padding: 12px 30px;
      background: #667eea;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .upload-btn:hover {
      background: #764ba2;
      transform: translateY(-2px);
    }

    .file-status {
      margin-top: 15px;
      font-size: 14px;
      color: #666;
    }

    .file-status.loaded {
      color: #48bb78;
      font-weight: bold;
    }

    .compare-btn {
      width: 100%;
      padding: 15px;
      background: #48bb78;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .compare-btn:hover:not(:disabled) {
      background: #38a169;
      transform: translateY(-2px);
    }

    .compare-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* Dashboard Section */
    .dashboard {
      display: none;
    }

    .dashboard.active {
      display: block;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }

    .dashboard-header h2 {
      font-size: 28px;
      color: #667eea;
    }

    .reset-btn {
      padding: 10px 20px;
      background: #e53e3e;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .reset-btn:hover {
      background: #c53030;
    }

    /* Alignment Overview */
    .alignment-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
      border-left: 4px solid;
    }

    .stat-card.green {
      border-color: #48bb78;
    }

    .stat-card.yellow {
      border-color: #ffc107;
    }

    .stat-card.red {
      border-color: #e53e3e;
    }

    .stat-value {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
    }

    /* Domain Cards */
    .domain-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 25px;
      overflow: hidden;
    }

    .domain-header {
      padding: 20px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.3s;
    }

    .domain-header:hover {
      background: #f8f9ff;
    }

    .domain-header.green {
      border-left: 6px solid #48bb78;
    }

    .domain-header.yellow {
      border-left: 6px solid #ffc107;
    }

    .domain-header.red {
      border-left: 6px solid #e53e3e;
    }

    .domain-title {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .alignment-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      color: white;
    }

    .alignment-badge.green {
      background: #48bb78;
    }

    .alignment-badge.yellow {
      background: #ffc107;
      color: #333;
    }

    .alignment-badge.red {
      background: #e53e3e;
    }

    .domain-content {
      display: none;
      padding: 20px;
      background: #fafafa;
    }

    .domain-content.active {
      display: block;
    }

    /* Comparison Table */
    .comparison-item {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      border-left: 4px solid #e0e0e0;
    }

    .comparison-item.aligned {
      border-left-color: #48bb78;
      background: #f0fff4;
    }

    .comparison-item.moderate {
      border-left-color: #ffc107;
      background: #fff8e1;
    }

    .comparison-item.different {
      border-left-color: #e53e3e;
      background: #fff5f5;
    }

    .question-label {
      font-weight: bold;
      color: #555;
      margin-bottom: 10px;
    }

    .responses {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .response {
      padding: 10px;
      background: white;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }

    .response-header {
      font-size: 12px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }

    .response-value {
      color: #333;
    }

    .gap-indicator {
      grid-column: 1 / -1;
      padding: 10px;
      background: #f8f9ff;
      border-radius: 4px;
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-top: 5px;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    /* Export Button */
    .export-btn {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .export-btn:hover {
      background: #764ba2;
    }

    /* Recommendations Section */
    .recommendations {
      background: #fff3cd;
      border: 2px solid #ffc107;
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
    }

    .recommendations h3 {
      color: #856404;
      margin-bottom: 15px;
    }

    .recommendation-item {
      padding: 10px 0;
      border-bottom: 1px solid #ffeaa7;
    }

    .recommendation-item:last-child {
      border-bottom: none;
    }

    @media (max-width: 768px) {
      .upload-grid {
        grid-template-columns: 1fr;
      }

      .responses {
        grid-template-columns: 1fr;
      }

      .alignment-overview {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ü§ù Couples Planning Comparison Tool</h1>
      <p class="subtitle">Alignment Dashboard & Discussion Preparation</p>
      <div style="margin-top: 15px;">
        <a href="index.html" style="color: white; text-decoration: none; padding: 10px 20px; background: rgba(255,255,255,0.2); border-radius: 6px; display: inline-block; transition: all 0.3s;">
          üìù Haven't filled out the questionnaire yet? Start here
        </a>
      </div>
    </header>

    <main>
      <!-- Upload Section -->
      <div class="upload-section" id="uploadSection">
        <h2>üì§ Load Your Questionnaires</h2>
        <p style="margin-bottom: 20px; color: #666;">Upload both completed JSON files to see your alignment dashboard</p>
        
        <div class="upload-grid">
          <div class="upload-box">
            <h3>Partner 1</h3>
            <label for="file1" class="upload-btn">Choose File</label>
            <input type="file" id="file1" accept=".json" onchange="loadFile(1, this.files[0])">
            <div class="file-status" id="status1">No file selected</div>
          </div>

          <div class="upload-box">
            <h3>Partner 2</h3>
            <label for="file2" class="upload-btn">Choose File</label>
            <input type="file" id="file2" accept=".json" onchange="loadFile(2, this.files[0])">
            <div class="file-status" id="status2">No file selected</div>
          </div>
        </div>

        <button class="compare-btn" id="compareBtn" onclick="generateComparison()" disabled>
          üîç Generate Alignment Dashboard
        </button>
      </div>

      <!-- Dashboard Section -->
      <div class="dashboard" id="dashboard">
        <div class="dashboard-header">
          <h2>üìä Alignment Dashboard</h2>
          <button class="reset-btn" onclick="resetTool()">üîÑ Load Different Files</button>
        </div>

        <!-- Overview Stats -->
        <div class="alignment-overview" id="overviewStats"></div>

        <!-- Domain Comparisons -->
        <div id="domainComparisons"></div>

        <!-- Recommendations -->
        <div class="recommendations" id="recommendations"></div>

        <!-- Export Button -->
        <div style="text-align: center; margin-top: 30px;">
          <button class="export-btn" onclick="exportReport()">üìÑ Export Full Comparison Report</button>
        </div>
      </div>
    </main>
  </div>

  <script>
    let partner1Data = null;
    let partner2Data = null;

    function loadFile(partner, file) {
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (partner === 1) {
            partner1Data = data;
            document.getElementById('status1').textContent = `‚úì Loaded: ${file.name}`;
            document.getElementById('status1').classList.add('loaded');
          } else {
            partner2Data = data;
            document.getElementById('status2').textContent = `‚úì Loaded: ${file.name}`;
            document.getElementById('status2').classList.add('loaded');
          }

          // Enable compare button if both files loaded
          if (partner1Data && partner2Data) {
            document.getElementById('compareBtn').disabled = false;
          }
        } catch (err) {
          alert('Error loading file: ' + err.message);
        }
      };
      reader.readAsText(file);
    }

    function generateComparison() {
      if (!partner1Data || !partner2Data) return;

      // Hide upload section, show dashboard
      document.getElementById('uploadSection').style.display = 'none';
      document.getElementById('dashboard').classList.add('active');

      // Generate comparisons
      generateOverviewStats();
      generateDomainComparisons();
      generateRecommendations();
    }

    function generateOverviewStats() {
      const stats = calculateAlignmentStats();
      const container = document.getElementById('overviewStats');
      
      container.innerHTML = `
        <div class="stat-card green">
          <div class="stat-value">${stats.green}</div>
          <div class="stat-label">üü¢ Strong Alignment</div>
        </div>
        <div class="stat-card yellow">
          <div class="stat-value">${stats.yellow}</div>
          <div class="stat-label">üü° Moderate Gaps</div>
        </div>
        <div class="stat-card red">
          <div class="stat-value">${stats.red}</div>
          <div class="stat-label">üî¥ Significant Gaps</div>
        </div>
        <div class="stat-card" style="border-color: #667eea;">
          <div class="stat-value">${stats.overall}%</div>
          <div class="stat-label">Overall Alignment</div>
        </div>
      `;
    }

    function calculateAlignmentStats() {
      let green = 0, yellow = 0, red = 0, total = 0;

      // Compare numeric ratings (1-10 scale questions)
      const ratingFields = [
        'mental_wellbeing', 'mental_stress', 'mental_satisfaction',
        'physical_health', 'physical_fitness_satisfaction',
        'career_satisfaction', 'career_worklife_balance',
        'finance_satisfaction', 'finance_stress',
        'social_couple_time', 'social_alone_time',
        'spiritual_satisfaction', 'spiritual_importance',
        'relationshipSatisfaction'
      ];

      ratingFields.forEach(field => {
        const val1 = parseInt(partner1Data[field]);
        const val2 = parseInt(partner2Data[field]);
        
        if (!isNaN(val1) && !isNaN(val2)) {
          total++;
          const gap = Math.abs(val1 - val2);
          
          if (gap <= 2) green++;
          else if (gap <= 5) yellow++;
          else red++;
        }
      });

      const overall = total > 0 ? Math.round((green / total) * 100) : 0;

      return { green, yellow, red, overall };
    }

    function generateDomainComparisons() {
      const container = document.getElementById('domainComparisons');
      const domains = [
        {
          id: 'snapshot',
          name: 'Relationship Snapshot',
          fields: ['relationshipSatisfaction', 'bestMoment', 'biggestChallenge']
        },
        {
          id: 'mental',
          name: 'Mental & Emotional Well-being',
          fields: ['mental_wellbeing', 'mental_stress', 'mental_needs', 'mental_stressors']
        },
        {
          id: 'physical',
          name: 'Physical Health & Fitness',
          fields: ['physical_health', 'physical_sleep_hours', 'physical_exercise_freq', 'physical_frustrations']
        },
        {
          id: 'career',
          name: 'Professional Life & Career',
          fields: ['career_satisfaction', 'career_worklife_balance', 'career_changes', 'career_relocation']
        },
        {
          id: 'finance',
          name: 'Financial Life',
          fields: ['finance_satisfaction', 'finance_stress', 'finance_debt_comfort', 'finance_retire_age', 'finance_accounts']
        },
        {
          id: 'social',
          name: 'Relationships & Social Life',
          fields: ['social_couple_time', 'social_alone_time', 'social_frequency', 'social_family_involvement']
        },
        {
          id: 'spiritual',
          name: 'Spiritual & Intellectual Life',
          fields: ['spiritual_importance', 'spiritual_partner_sharing', 'spiritual_value1', 'spiritual_value2', 'spiritual_value3']
        }
      ];

      let html = '';
      
      domains.forEach(domain => {
        const alignment = calculateDomainAlignment(domain.fields);
        const badge = alignment.level === 'high' ? 'green' : alignment.level === 'medium' ? 'yellow' : 'red';
        const badgeText = alignment.level === 'high' ? 'Strong Alignment' : alignment.level === 'medium' ? 'Moderate Gap' : 'Needs Discussion';

        html += `
          <div class="domain-card">
            <div class="domain-header ${badge}" onclick="toggleDomain('${domain.id}')">
              <div class="domain-title">${domain.name}</div>
              <span class="alignment-badge ${badge}">${badgeText}</span>
            </div>
            <div class="domain-content" id="domain-${domain.id}">
              ${generateDomainComparisons(domain.fields)}
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function calculateDomainAlignment(fields) {
      let totalGap = 0;
      let count = 0;

      fields.forEach(field => {
        const val1 = partner1Data[field];
        const val2 = partner2Data[field];

        if (typeof val1 === 'number' && typeof val2 === 'number') {
          totalGap += Math.abs(val1 - val2);
          count++;
        }
      });

      const avgGap = count > 0 ? totalGap / count : 0;
      
      let level = 'high';
      if (avgGap > 5) level = 'low';
      else if (avgGap > 2) level = 'medium';

      return { level, avgGap };
    }

    function generateDomainComparisons(fields) {
      let html = '';

      if (!fields || !Array.isArray(fields)) {
        return '<p style="padding: 20px; text-align: center; color: #999;">No fields defined for this domain</p>';
      }

      fields.forEach(field => {
        if (!partner1Data || !partner2Data) return;
        
        const val1 = partner1Data[field];
        const val2 = partner2Data[field];

        if (val1 === undefined && val2 === undefined) return;

        const comparison = compareValues(val1, val2);
        const label = formatFieldLabel(field);

        html += `
          <div class="comparison-item ${comparison.class}">
            <div class="question-label">${label}</div>
            <div class="responses">
              <div class="response">
                <div class="response-header">${partner1Data.partnerName || 'Partner 1'}</div>
                <div class="response-value">${formatValue(val1)}</div>
              </div>
              <div class="response">
                <div class="response-header">${partner2Data.partnerName || 'Partner 2'}</div>
                <div class="response-value">${formatValue(val2)}</div>
              </div>
              ${comparison.message ? `<div class="gap-indicator">${comparison.message}</div>` : ''}
            </div>
          </div>
        `;
      });

      return html || '<p style="padding: 20px; text-align: center; color: #999;">No comparable data in this domain</p>';
    }

    function compareValues(val1, val2) {
      if (typeof val1 === 'number' && typeof val2 === 'number') {
        const gap = Math.abs(val1 - val2);
        if (gap <= 2) return { class: 'aligned', message: `‚úì Well aligned (gap: ${gap})` };
        if (gap <= 5) return { class: 'moderate', message: `‚ö† Moderate difference (gap: ${gap})` };
        return { class: 'different', message: `‚ö†Ô∏è Significant difference (gap: ${gap}) - needs discussion` };
      }

      if (val1 === val2) return { class: 'aligned', message: '‚úì Same response' };
      
      return { class: 'different', message: '‚ö† Different responses - review together' };
    }

    function formatFieldLabel(field) {
      const labels = {
        'relationshipSatisfaction': 'Overall Relationship Satisfaction',
        'mental_wellbeing': 'Mental/Emotional Well-being',
        'mental_stress': 'Current Stress Level',
        'physical_health': 'Physical Health Rating',
        'career_satisfaction': 'Career Satisfaction',
        'finance_satisfaction': 'Financial Satisfaction',
        'finance_retire_age': 'Desired Retirement Age',
        'social_couple_time': 'Quality Couple Time',
        'spiritual_importance': 'Importance of Spirituality'
      };

      return labels[field] || field.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    }

    function formatValue(val) {
      if (val === null || val === undefined || val === '') return '(Not answered)';
      if (typeof val === 'number') return val.toString();
      if (typeof val === 'string' && val.length > 100) return val.substring(0, 100) + '...';
      return val;
    }

    function toggleDomain(domainId) {
      const content = document.getElementById(`domain-${domainId}`);
      content.classList.toggle('active');
    }

    function generateRecommendations() {
      const container = document.getElementById('recommendations');
      const stats = calculateAlignmentStats();

      let recommendations = '<h3>üí° Discussion Recommendations</h3>';

      if (stats.red > 0) {
        recommendations += `
          <div class="recommendation-item">
            <strong>üî¥ HIGH PRIORITY:</strong> You have ${stats.red} areas with significant gaps. These should be your primary focus in your planning session. Use the "Navigate Conflicts" phase (Phase 5) in the discussion guide.
          </div>
        `;
      }

      if (stats.yellow > 2) {
        recommendations += `
          <div class="recommendation-item">
            <strong>üü° MODERATE ATTENTION:</strong> ${stats.yellow} areas show moderate differences. Use the "Understand Differences" phase (Phase 3) to explore these areas and find common ground.
          </div>
        `;
      }

      if (stats.green > stats.red + stats.yellow) {
        recommendations += `
          <div class="recommendation-item">
            <strong>üü¢ CELEBRATE:</strong> You have ${stats.green} areas of strong alignment! Start your session with Phase 2 "Celebrate Alignment" to build positive momentum.
          </div>
        `;
      }

      recommendations += `
        <div class="recommendation-item">
          <strong>‚è∞ TIME ALLOCATION:</strong> Based on your alignment, plan for ${Math.max(3, Math.ceil(stats.red * 0.75 + stats.yellow * 0.5 + 1))} hours for your planning session.
        </div>
        <div class="recommendation-item">
          <strong>üìã NEXT STEP:</strong> Review the areas marked in red before your session. Come prepared to explain "why" these matters to you, not just "what" you want.
        </div>
      `;

      container.innerHTML = recommendations;
    }

    function resetTool() {
      partner1Data = null;
      partner2Data = null;
      document.getElementById('status1').textContent = 'No file selected';
      document.getElementById('status1').classList.remove('loaded');
      document.getElementById('status2').textContent = 'No file selected';
      document.getElementById('status2').classList.remove('loaded');
      document.getElementById('file1').value = '';
      document.getElementById('file2').value = '';
      document.getElementById('compareBtn').disabled = true;
      document.getElementById('uploadSection').style.display = 'block';
      document.getElementById('dashboard').classList.remove('active');
    }

    function exportReport() {
      const dashboard = document.getElementById('dashboard');
      const content = dashboard.innerHTML;
      
      const reportHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Couples Planning Comparison Report</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 40px; max-width: 1200px; margin: 0 auto; }
            h1 { color: #667eea; }
            .stat-card { display: inline-block; padding: 20px; margin: 10px; border: 2px solid #ddd; border-radius: 8px; }
            .domain-card { margin: 20px 0; border: 1px solid #ddd; border-radius: 8px; }
            .domain-header { background: #f5f5f5; padding: 15px; font-weight: bold; }
            .comparison-item { padding: 15px; margin: 10px 0; border-left: 4px solid #ddd; }
            .aligned { border-left-color: #48bb78; background: #f0fff4; }
            .moderate { border-left-color: #ffc107; background: #fff8e1; }
            .different { border-left-color: #e53e3e; background: #fff5f5; }
          </style>
        </head>
        <body>
          <h1>ü§ù Couples Planning Comparison Report</h1>
          <p>Generated: ${new Date().toLocaleString()}</p>
          <p>Partners: ${partner1Data.partnerName || 'Partner 1'} & ${partner2Data.partnerName || 'Partner 2'}</p>
          <hr>
          ${content}
        </body>
        </html>
      `;

      const blob = new Blob([reportHTML], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `couples-comparison-report-${new Date().toISOString().split('T')[0]}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
